<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Google</title>
    <style>
      #failCounter1, #failCounter2, #failCounter3, #failCounter4{display: none;}
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
            overflow: hidden;
            font-family: Arial, sans-serif;
        }
        
        /* Added scale transform to prevent white edges when blurred */
        .background-layer {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: url('https://i.postimg.cc/3x0y1KTx/tessellation-patterns-multi-1024x576.jpg');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            z-index: -1;
            transition: filter 1s ease, transform 1s ease;
        }
        
        .background-layer.blurred {
            filter: blur(10px);
            transform: scale(1.05);
        }
        
        /* Made header links white and added hover effect */
        .google-header {
            position: fixed;
            top: 0;
            right: 0;
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px 20px;
            z-index: 1;
            transition: filter 1s ease;
        }
        
        /* Added blur effect for header when blurred class is applied */
        .google-header.blurred {
            filter: blur(10px);
        }
        
        .google-header a {
            color: #fff;
            text-decoration: none;
            font-size: 13px;
            transition: opacity 0.2s;
        }
        
        .google-header a:hover {
            opacity: 0.8;
        }
        
        .google-apps-icon {
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            border-radius: 50%;
            transition: background 0.2s;
        }
        
        .google-apps-icon:hover {
            background: rgba(0,0,0,0.05);
        }
        
        .google-apps-icon svg {
            width: 20px;
            height: 20px;
            fill: #fff; /* Changed from #5f6368 to #fff to make 9 dots white */
        }
        
        .google-user-icon {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: #4285f4;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: box-shadow 0.2s;
        }
        
        .google-user-icon:hover {
            box-shadow: 0 1px 3px rgba(0,0,0,0.2);
        }
        
        .google-background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 0;
            transition: filter 1s ease;
        }
        
        .google-background.blurred {
            filter: blur(10px);
        }
        
        .google-logo {
            font-size: 90px;
            font-weight: 400;
            margin-bottom: 30px;
            letter-spacing: -2px;
        }
        
        .google-logo span:nth-child(1) { color: #fff; }
        .google-logo span:nth-child(2) { color: #fff; }
        .google-logo span:nth-child(3) { color: #fff; }
        .google-logo span:nth-child(4) { color: #fff; }
        .google-logo span:nth-child(5) { color: #fff; }
        .google-logo span:nth-child(6) { color: #fff; }
        
        .google-search-box {
            width: 584px;
            max-width: 90%;
            height: 44px;
            border: 1px solid #dfe1e5;
            border-radius: 24px;
            display: flex;
            align-items: center;
            padding: 0 14px;
            box-shadow: 0 1px 6px rgba(32,33,36,.28);
            margin-bottom: 30px;
            background: #fff;
        }
        
        .google-search-box:hover {
            box-shadow: 0 1px 6px rgba(32,33,36,.4);
        }
        
        .search-icon {
            width: 20px;
            height: 20px;
            margin-right: 12px;
            opacity: 0.6;
        }
        
        .google-search-input {
            flex: 1;
            border: none;
            outline: none;
            font-size: 16px;
            color: #202124;
        }
        
        .search-actions {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-left: 8px;
        }
        
        .search-action-btn {
            width: 24px;
            height: 24px;
            padding: 0;
            border: none;
            background: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0.6;
            transition: opacity 0.2s;
        }
        
        .search-action-btn:hover {
            opacity: 1;
        }
        
        .search-action-btn svg {
            width: 20px;
            height: 20px;
        }
        
        .google-buttons {
            display: flex;
            gap: 12px;
            margin-top: 8px;
        }
        
        .google-btn {
            background: #f8f9fa;
            border: 1px solid #f8f9fa;
            border-radius: 4px;
            color: #3c4043;
            font-size: 14px;
            padding: 10px 16px;
            cursor: pointer;
            transition: all 0.1s;
        }
        
        .google-btn:hover {
            box-shadow: 0 1px 1px rgba(0,0,0,.1);
            border: 1px solid #dadce0;
        }
        
        body {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100vh;
        }
        .spinner {
            width: 80px;
            height: 80px;
            border: 8px solid #f3f3f3;
            border-top: 8px solid #4285f4;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 40px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg);}
            100% { transform: rotate(360deg);}
        }
        
        .warning-text {
            display: none;
            font-size: 16px;
            color: #ea4335;
            font-weight: 500;
            margin-bottom: 20px;
            text-align: center;
            z-index: 8;
        }
        
        .captcha-fake {
            display: flex;
            flex-direction: row;
            align-items: center;
            background: #f9f9f9;
            border: 1px solid #d3d3d3;
            border-radius: 4px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.10);
            padding: 12px 18px 12px 12px;
            min-width: 320px;
            min-height: 80px;
            position: relative;
            cursor: pointer;
            user-select: none;
            transition: box-shadow 0.2s;
            z-index: 10;
        }
        .captcha-fake:active {
            box-shadow: 0 2px 16px rgba(66,133,244,0.15);
        }
        .captcha-checkbox {
            width: 28px;
            height: 28px;
            border: 2px solid #c1c1c1;
            border-radius: 3px;
            background: #fff;
            margin-right: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 22px;
            color: #4285f4;
            transition: border-color 0.2s;
        }
        .captcha-checkbox.checked {
            border-color: #4285f4;
            background: #e8f0fe;
        }
        .captcha-fake-label {
            font-size: 16px;
            color: #222;
            font-family: Arial, sans-serif;
            margin-right: 18px;
        }
        .captcha-fake-logo {
            width: 32px;
            height: 32px;
            margin-left: auto;
        }
        .captcha-fake-x {
            display: none;
            position: absolute;
            top: 8px;
            right: 10px;
            font-size: 22px;
            color: #888;
            background: none;
            border: none;
            cursor: pointer;
            z-index: 2;
        }
        .captcha-fake-x:hover {
            color: #222;
        }
        .captcha-modal {
            display: none;
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: transparent;
            align-items: center;
            justify-content: center;
            z-index: 100;
        }
        .captcha-window {
            background: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 16px rgba(0,0,0,0.2);
            width: 370px;
            padding: 0;
            font-family: Arial, sans-serif;
            overflow: hidden;
            position: relative;
        }
        .captcha-header {
            background: #f9f9f9;
            padding: 16px;
            display: flex;
            align-items: center;
            border-bottom: 1px solid #eee;
        }
        .captcha-logo {
            width: 32px;
            height: 32px;
            margin-right: 12px;
        }
        .captcha-title {
            font-size: 16px;
            color: #222;
            font-weight: bold;
        }
        .captcha-content {
            padding: 24px 16px 16px 16px;
            text-align: center;
        }
        .maze-container {
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .maze {
            display: grid;
            grid-template-columns: repeat(15, 16px);
            grid-template-rows: repeat(15, 16px);
            gap: 2px;
            margin: 0 auto;
        }
        .maze-cell {
            width: 16px;
            height: 16px;
            background: #e0e0e0;
            border-radius: 4px;
        }
        .maze-wall {
            background: #757575;
        }
        .maze-player {
            background: #4285f4;
        }
        .maze-end {
            background: #34a853;
        }
        .captcha-close {
            position: absolute;
            top: 12px;
            right: 16px;
            background: none;
            border: none;
            font-size: 20px;
            color: #888;
            cursor: pointer;
        }
        .captcha-close:hover {
            color: #222;
        }
        .captcha-footer {
            padding: 12px 16px;
            background: #f9f9f9;
            border-top: 1px solid #eee;
            text-align: right;
        }
        .captcha-success {
            color: #34a853;
            font-weight: bold;
            margin-top: 12px;
        }
        .captcha-fail {
            color: #ea4335;
            font-weight: bold;
            margin-top: 12px;
        }
        #tttRestart {
            display: none;
            margin: 18px auto 0 auto;
            padding: 0 28px;
            height: 36px;
            background: #f1f3f4;
            color: #222;
            border: 1px solid #d3d3d3;
            border-radius: 4px;
            font-size: 15px;
            font-family: Arial, sans-serif;
            font-weight: 500;
            cursor: pointer;
            box-shadow: 0 1px 2px rgba(60,64,67,0.08);
            transition: background 0.2s, border-color 0.2s;
            display: block;
        }
        #tttRestart:hover {
            background: #e8f0fe;
            border-color: #4285f4;
            color: #174ea6;
        }
        .final-btn {
            background: #f1f3f4;
            color: #222;
            border: 1px solid #d3d3d3;
            border-radius: 4px;
            font-size: 15px;
            font-family: Arial, sans-serif;
            font-weight: 500;
            cursor: pointer;
            box-shadow: 0 1px 2px rgba(60,64,67,0.08);
            transition: background 0.2s, border-color 0.2s, left 0.2s, top 0.2s;
            height: 38px;
            margin: 0 auto;
            display: block;
            min-width: 120px;
        }
        .final-btn:hover {
            background: #e8f0fe;
            border-color: #4285f4;
            color: #174ea6;
        }
        #captchaFinalModal .captcha-content > div[style*="flex"] {
            position: relative;
            min-height: 120px;
        }
        #btnHuman {
            position: absolute;
            transition: background 0s;
        }
        
        .word-search-container {
            position: relative;
            display: inline-block;
            margin: 0 auto;
        }
        .word-search-grid {
            /* increased grid from 10x10 to 15x15 */
            display: grid;
            grid-template-columns: repeat(15, 21px);
            grid-template-rows: repeat(15, 21px);
            gap: 2px;
            position: relative;
            user-select: none;
        }
        .word-search-cell {
            /* reduced cell size from 32px to 21px to maintain same visual size */
            width: 21px;
            height: 21px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: bold;
            color: #222;
            background: #f5f5f5;
            border-radius: 4px;
            cursor: pointer;
            position: relative;
            z-index: 2;
            transition: background-color 0.3s ease;
        }
        .word-search-cell.found {
            color: #fff;
            font-weight: bold;
        }
        .word-search-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
        }
        .word-list {
            margin-top: 16px;
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            justify-content: center;
        }
        .word-item {
            padding: 6px 12px;
            background: #f1f3f4;
            border-radius: 16px;
            font-size: 14px;
            color: #555;
            transition: all 0.3s;
        }
        .word-item.found {
            background: #34a853;
            color: #fff;
            text-decoration: line-through;
        }
        
        #mainContainer {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 5;
            pointer-events: none;
        }
        
        #mainContainer > * {
            pointer-events: auto;
        }
    </style>
</head>
<body>
    <!-- Added background layer div -->
    <div class="background-layer"></div>
    
    <div class="google-header">
        <a href="#">Gmail</a>
        <a href="#">Зображення</a>
        <div class="google-apps-icon" title="Додатки Google">
            <svg viewBox="0 0 24 24">
                <path d="M6,8c1.1,0 2,-0.9 2,-2s-0.9,-2 -2,-2 -2,0.9 -2,2 0.9,2 2,2zM12,20c1.1,0 2,-0.9 2,-2s-0.9,-2 -2,-2 -2,0.9 -2,2 0.9,2 2,2zM6,20c1.1,0 2,-0.9 2,-2s-0.9,-2 -2,-2 -2,0.9 -2,2 0.9,2 2,2zM6,14c1.1,0 2,-0.9 2,-2s-0.9,-2 -2,-2 -2,0.9 -2,2 0.9,2 2,2zM12,14c1.1,0 2,-0.9 2,-2s-0.9,-2 -2,-2 -2,0.9 -2,2 0.9,2 2,2zM16,6c0,1.1 0.9,2 2,2s2,-0.9 2,-2 -0.9,-2 -2,-2 -2,0.9 -2,2zM12,8c1.1,0 2,-0.9 2,-2s-0.9,-2 -2,-2 -2,0.9 -2,2 0.9,2 2,2zM18,14c1.1,0 2,-0.9 2,-2s-0.9,-2 -2,-2 -2,0.9 -2,2 0.9,2 2,2zM18,20c1.1,0 2,-0.9 2,-2s-0.9,-2 -2,-2 -2,0.9 -2,2 0.9,2 2,2z"></path>
            </svg>
        </div>
        <div class="google-user-icon" title="Обліковий запис Google">
            У
        </div>
    </div>
    
    <div class="google-background">
        <div class="google-logo">
            <span>G</span><span>o</span><span>o</span><span>g</span><span>l</span><span>e</span>
        </div>
        <div class="google-search-box">
            <svg class="search-icon" focusable="false" xmlns="http://www.w3.org/2000/svg">
                <path fill="#9aa0a6" d="M15.5 14h-.79l-.28-.27A6.471 6.471 0 0 0 16 9.5 6.5 6.5 0 1 0 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"></path>
            </svg>
            <input type="text" class="google-search-input" />
            
            <div class="search-actions">
                <button class="search-action-btn" aria-label="Голосовий пошук">
                    <svg focusable="false" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path fill="#4285f4" d="m12 15c1.66 0 3-1.31 3-2.97v-7.02c0-1.66-1.34-3.01-3-3.01s-3 1.34-3 3.01v7.02c0 1.66 1.34 2.97 3 2.97z"></path>
                        <path fill="#34a853" d="m11 18.08h2v3.92h-2z"></path>
                        <path fill="#fbbc05" d="m7.05 16.87c-1.27-1.33-2.05-2.83-2.05-4.87h2c0 1.45 0.56 2.42 1.47 3.38v0.32l-1.15 1.18z"></path>
                        <path fill="#ea4335" d="m12 16.93a4.97 5.25 0 0 1 -3.54 -1.55l-1.41 1.49c1.26 1.34 3.02 2.13 4.95 2.13 3.87 0 6.99-2.92 6.99-7h-1.99c0 2.92-2.24 4.93-5 4.93z"></path>
                    </svg>
                </button>
                <button class="search-action-btn" aria-label="Пошук за зображенням">
                    <svg focusable="false" viewBox="0 0 192 192" xmlns="http://www.w3.org/2000/svg">
                        <rect fill="none" height="192" width="192"></rect>
                        <g>
                            <circle fill="#34a853" cx="144.07" cy="144" r="16"></circle>
                            <circle fill="#4285f4" cx="96.07" cy="104" r="24"></circle>
                            <path fill="#ea4335" d="M24,135.2c0,18.11,14.69,32.8,32.8,32.8H96v-16l-40.1-0.1c-8.8,0-15.9-8.19-15.9-17.9v-18H24V135.2z"></path>
                            <path fill="#fbbc05" d="M168,72.8c0-18.11-14.69-32.8-32.8-32.8H116l20,16c8.8,0,16,8.29,16,18v30h16V72.8z"></path>
                            <path fill="#4285f4" d="M112,24l-32,0L68,40H56.8C38.69,40,24,54.69,24,72.8V92h16V74c0-9.71,7.2-18,16-18h80L112,24z"></path>
                        </g>
                    </svg>
                </button>
            </div>
        </div>
        <div class="google-buttons">
            <button class="google-btn">Пошук Google</button>
            <button class="google-btn">Мені пощастить</button>
        </div>
    </div>
    
    <div id="mainContainer">
        <div id="spinnerBox" style="display:none;">
            <div class="spinner"></div>
        </div>
        <div id="captchaFake" class="captcha-fake" tabindex="0" style="display:none;">
            <div id="captchaCheckbox" class="captcha-checkbox"></div>
            <span class="captcha-fake-label">Я не робот</span>
            <img class="captcha-fake-logo" src="https://www.gstatic.com/recaptcha/api2/logo_48.png" alt="reCAPTCHA">
        </div>
    </div>
    
    <div class="captcha-modal" id="captchaModal">
        <div class="captcha-window">
            <button class="captcha-close" id="closeCaptcha" aria-label="Закрити">&times;</button>
            <div class="captcha-header">
                <img class="captcha-logo" src="https://www.gstatic.com/recaptcha/api2/logo_48.png" alt="reCAPTCHA">
                <div class="captcha-title">ReCaptcha</div>
                <div id="failCounter1" style="position:absolute;top:10px;right:16px;font-size:13px;color:#ea4335;font-weight:bold;">Помилок: 0</div>
            </div>
            <div class="captcha-content">
                <div style="font-size:13px;color:#555;margin-bottom:10px;">Проведіть синій квадрат до зеленого, використовуючи стрілки або WASD/ФЦІВ.</div>
                <div class="maze-container">
                    <div class="maze" id="maze"></div>
                </div>
                <div id="captchaSuccess" class="captcha-success" style="display:none;">Успіх!</div>
                <div id="captchaFail" class="captcha-fail" style="display:none;">Ви програли. Спробуйте ще раз.</div>
            </div>
            <div class="captcha-footer">
                <span style="font-size:11px;color:#888;">Ця сторінка захищена reCAPTCHA</span>
            </div>
        </div>
    </div>
    
    <div class="captcha-modal" id="captchaSimonModal" style="display:none;">
        <div class="captcha-window">
            <button class="captcha-close" id="closeSimon" aria-label="Закрити">&times;</button>
            <div class="captcha-header">
                <img class="captcha-logo" src="https://www.gstatic.com/recaptcha/api2/logo_48.png" alt="reCAPTCHA">
                <div class="captcha-title">ReCaptcha</div>
                <div id="failCounter2" style="position:absolute;top:10px;right:16px;font-size:13px;color:#ea4335;font-weight:bold;">Помилок: 0</div>
            </div>
            <div class="captcha-content">
                <div style="font-size:13px;color:#555;margin-bottom:10px;">
                    Запам'ятайте послідовність! Повторіть шаблон, натискаючи квадрати в тому ж порядку.
                </div>
                <div id="simonGrid" style="display:grid;grid-template-columns:repeat(3,48px);grid-template-rows:repeat(3,48px);gap:10px;justify-content:center;margin:0 auto 10px auto;"></div>
                <div id="simonStatus" style="font-size:15px;color:#34a853;display:none;margin-top:10px;">Ви перемогли!</div>
                <div id="simonFail" style="font-size:15px;color:#ea4335;display:none;margin-top:10px;">Неправильно! Спробуйте знову.</div>
                <button id="simonRestart" style="display:none;margin-top:10px;">Перезапустити</button>
            </div>
            <div class="captcha-footer">
                <span style="font-size:11px;color:#888;">Ця сторінка захищена reCAPTCHA</span>
            </div>
        </div>
    </div>
    
    <div class="captcha-modal" id="captchaTicTacToeModal" style="display:none;">
        <div class="captcha-window">
            <button class="captcha-close" id="closeTicTacToe" aria-label="Закрити">&times;</button>
            <div class="captcha-header" style="position:relative;">
                <img class="captcha-logo" src="https://www.gstatic.com/recaptcha/api2/logo_48.png" alt="reCAPTCHA">
                <div class="captcha-title">ReCaptcha</div>
                <div id="failCounter3"
                    style="display:none;position:absolute;top:44px;right:16px;font-size:13px;color:#ea4335;font-weight:bold;z-index:2;">
                    Помилок: 0
                </div>
            </div>
            <div class="captcha-content">
                <div style="font-size:13px;color:#555;margin-bottom:10px;">
                    Переможіть ШІ за 3 спроби! Ви ходите першим. У разі нічиєї, стартуючий змінюється.
                </div>
                <div id="tttGrid" style="display:grid;grid-template-columns:repeat(3,48px);grid-template-rows:repeat(3,48px);gap:10px;justify-content:center;margin:0 auto 10px auto;"></div>
                <div id="tttStatus" style="font-size:15px;color:#34a853;display:none;margin-top:10px;"></div>
                <div id="tttFail" style="font-size:15px;color:#ea4335;display:none;margin-top:10px;"></div>
                <button id="tttRestart" style="display:none;margin-top:10px;">Наступний раунд</button>
            </div>
            <div class="captcha-footer">
                <span style="font-size:11px;color:#888;">Ця сторінка захищена reCAPTCHA</span>
            </div>
        </div>
    </div>
    
    <div class="captcha-modal" id="captchaWordSearchModal" style="display:none;">
        <div class="captcha-window" style="width: 420px;">
            <button class="captcha-close" id="closeWordSearch" aria-label="Закрити">&times;</button>
            <div class="captcha-header">
                <img class="captcha-logo" src="https://www.gstatic.com/recaptcha/api2/logo_48.png" alt="reCAPTCHA">
                <div class="captcha-title">ReCaptcha</div>
                <div id="failCounter4" style="position:absolute;top:10px;right:16px;font-size:13px;color:#ea4335;font-weight:bold;">Помилок: 0</div>
            </div>
            <div class="captcha-content">
                <div style="font-size:13px;color:#555;margin-bottom:10px;">
                    Знайдіть всі 5 слів у сітці. Слова можуть бути горизонтальними або вертикальними.
                </div>
                <div class="word-search-container">
                    <canvas id="wordSearchCanvas" class="word-search-overlay"></canvas>
                    <div id="wordSearchGrid" class="word-search-grid"></div>
                </div>
                <div id="wordList" class="word-list"></div>
                <div id="wordSearchSuccess" class="captcha-success" style="display:none;">Вітаємо! Ви знайшли всі слова!</div>
                <div id="wordSearchFail" class="captcha-fail" style="display:none;">Спробуйте ще раз!</div>
            </div>
            <div class="captcha-footer">
                <span style="font-size:11px;color:#888;">Ця сторінка захищена reCAPTCHA</span>
            </div>
        </div>
    </div>
    
    <div class="captcha-modal" id="captchaFinalModal" style="display:none;">
        <div class="captcha-window">
            <button class="captcha-close" id="closeFinal" aria-label="Закрити">&times;</button>
            <div class="captcha-header">
                <img class="captcha-logo" src="https://www.gstatic.com/recaptcha/api2/logo_48.png" alt="reCAPTCHA">
                <div class="captcha-title">ReCaptcha</div>
            </div>
            <div class="captcha-content">
                <div style="font-size:16px;color:#222;font-weight:bold;margin-bottom:24px;">Ви людина?</div>
                <div style="display:flex;flex-direction:column;align-items:center;gap:18px;">
                    <button id="btnRobot" class="final-btn" style="width:180px;">Я робот</button>
                    <button id="btnHuman" class="final-btn" style="width:180px;position:relative;">Я людина</button>
                </div>
            </div>
            <div class="captcha-footer">
                <span style="font-size:11px;color:#888;">Ця сторінка захищена reCAPTCHA</span>
            </div>
        </div>
    </div>

    <script>
        const moveKeys = {
            'w': {dx:0, dy:-1},
            'a': {dx:-1, dy:0},
            's': {dx:0, dy:1},
            'd': {dx:1, dy:0},
            'ф': {dx:-1, dy:0},
            'ц': {dx:0, dy:-1},
            'і': {dx:0, dy:1},
            'в': {dx:1, dy:0},
        };
        
        function generateMaze(width, height) {
            let maze = Array.from({length: height}, () => Array(width).fill(0));
            
            for (let i = 0; i < width; i++) {
                maze[0][i] = 0; // top wall
                maze[height-1][i] = 0; // bottom wall
            }
            for (let i = 0; i < height; i++) {
                maze[i][0] = 0; // left wall
                maze[i][width-1] = 0; // right wall
            }
            
            function carve(x, y) {
                maze[y][x] = 1;
                const dirs = [
                    [0, -2], [0, 2], [-2, 0], [2, 0]
                ].sort(() => Math.random() - 0.5);
                for (const [dx, dy] of dirs) {
                    const nx = x + dx, ny = y + dy;
                    if (ny > 0 && ny < height-1 && nx > 0 && nx < width-1 && maze[ny][nx] === 0) {
                        maze[y + dy/2][x + dx/2] = 1;
                        carve(nx, ny);
                    }
                }
            }
            carve(1, 1);
            maze[1][1] = 2;
            maze[height-2][width-2] = 3;
            return maze;
        }

        const MAZE_SIZE = 33; // changed maze size from 34 to 33
        let mazeData = generateMaze(MAZE_SIZE, MAZE_SIZE);
        let playerPos = {x:1, y:1};

        function findStart() {
            for(let y=0; y<mazeData.length; y++) {
                for(let x=0; x<mazeData[0].length; x++) {
                    if(mazeData[y][x] === 2) return {x, y};
                }
            }
            return {x:1, y:1};
        }

        function drawMaze() {
            const maze = document.getElementById('maze');
            maze.innerHTML = '';
            let viewSize = 15;
            let half = Math.floor(viewSize/2);
            
            let startX = playerPos.x - half;
            let startY = playerPos.y - half;
            let endX = playerPos.x + half;
            let endY = playerPos.y + half;
            
            if (startX < 0) {
                startX = 0;
                endX = viewSize - 1;
            }
            if (startY < 0) {
                startY = 0;
                endY = viewSize - 1;
            }
            if (endX > MAZE_SIZE - 1) {
                endX = MAZE_SIZE - 1;
                startX = MAZE_SIZE - viewSize;
            }
            if (endY > MAZE_SIZE - 1) {
                endY = MAZE_SIZE - 1;
                startY = MAZE_SIZE - viewSize;
            }
            
            if (playerPos.x <= 2) {
                startX = 0;
            }
            if (playerPos.x >= MAZE_SIZE - 3) {
                startX = MAZE_SIZE - viewSize;
            }
            if (playerPos.y <= 2) {
                startY = 0;
            }
            if (playerPos.y >= MAZE_SIZE - 3) {
                startY = MAZE_SIZE - viewSize;
            }
            
            maze.style.gridTemplateColumns = `repeat(${viewSize}, 16px)`;
            maze.style.gridTemplateRows = `repeat(${viewSize}, 16px)`;
            for(let y=0; y<viewSize; y++) {
                for(let x=0; x<viewSize; x++) {
                    let mx = startX + x, my = startY + y;
                    const cell = document.createElement('div');
                    cell.classList.add('maze-cell');
                    if (my >= mazeData.length || mx >= mazeData[0].length) {
                        cell.classList.add('maze-wall');
                    } else {
                        if(mazeData[my][mx] === 0) cell.classList.add('maze-wall');
                        if(mazeData[my][mx] === 3) cell.classList.add('maze-end');
                        if(playerPos.x === mx && playerPos.y === my) cell.classList.add('maze-player');
                    }
                    maze.appendChild(cell);
                }
            }
        }

        function updateMaze() {
            drawMaze();
        }

        function isValidMove(x, y) {
            return x >= 0 && y >= 0 && y < mazeData.length && x < mazeData[0].length && mazeData[y][x] !== 0;
        }

        function movePlayerTo(x, y) {
            if (mazeData[y][x] === 0) {
                document.getElementById('captchaFail').style.display = 'block';
                setTimeout(() => {
                    document.getElementById('captchaFail').style.display = 'none';
                    playerPos = findStart();
                    drawMaze();
                }, 900);
                return false;
            } else {
                playerPos.x = x;
                playerPos.y = y;
                updateMaze();
                checkWin();
                return true;
            }
        }

        function checkWin() {
            if(mazeData[playerPos.y][playerPos.x] === 3) {
                document.getElementById('captchaSuccess').style.display = 'block';
                setTimeout(() => {
                    document.getElementById('captchaModal').style.display = 'none';
                    isModalActive = false;
                    document.getElementById('captchaSimonModal').style.display = 'flex';
                    startSimonGame();
                }, 1000);
            }
        }

        let failCount1 = 0, failCount2 = 0, failCount3 = 0, failCount4 = 0;

        function updateFailCounters() {
            document.getElementById('failCounter1').textContent = `Помилок: ${failCount1}`;
            document.getElementById('failCounter2').textContent = `Помилок: ${failCount2}`;
            document.getElementById('failCounter3').textContent = `Помилок: ${failCount3}`;
            document.getElementById('failCounter4').textContent = `Помилок: ${failCount4}`;
        }

        function returnToMaze() {
            // Close all modals
            document.getElementById('captchaModal').style.display = 'none';
            document.getElementById('captchaSimonModal').style.display = 'none';
            document.getElementById('captchaTicTacToeModal').style.display = 'none';
            document.getElementById('captchaWordSearchModal').style.display = 'none';
            document.getElementById('captchaFinalModal').style.display = 'none';
            
            // Reset game states
            simonActive = false;
            tttGameActive = false;
            evadeActive = false;
            if(evadeAnimFrame) cancelAnimationFrame(evadeAnimFrame);
            if(evadeTimeout) clearTimeout(evadeTimeout);
            document.removeEventListener('mousemove', trackMouseGlobal);
            
            // Reset maze
            mazeData = generateMaze(MAZE_SIZE, MAZE_SIZE);
            playerPos = findStart();
            document.getElementById('captchaSuccess').style.display = 'none';
            document.getElementById('captchaFail').style.display = 'none';
            
            // Open maze modal
            setTimeout(() => {
                document.getElementById('captchaModal').style.display = 'flex';
                drawMaze();
                isModalActive = true;
            }, 500);
        }

        function failCaptcha() {
            failCount1++;
            updateFailCounters();
            document.getElementById('captchaFail').style.display = 'block';
            setTimeout(() => {
                returnToMaze();
            }, 1200);
        }

        function simonFailReload() {
            failCount2++;
            updateFailCounters();
            document.getElementById('simonFail').style.display = 'block';
            setTimeout(() => {
                returnToMaze();
            }, 1200);
        }

        let simonSequence = [];
        let simonStep = 0;
        let simonActive = false;
        let simonClickable = false;
        const simonGrid = [];
        const simonColors = [
            "#e0e0e0", "#e0e0e0", "#e0e0e0",
            "#e0e0e0", "#e0e0e0", "#e0e0e0",
            "#e0e0e0", "#e0e0e0", "#e0e0e0"
        ];
        const simonActiveColor = "#4285f4";

        function randomSimonCell() {
            return Math.floor(Math.random() * 9);
        }

        function startSimonGame() {
            simonSequence = [randomSimonCell()];
            simonStep = 0;
            simonActive = true;
            document.getElementById('simonStatus').style.display = 'none';
            document.getElementById('simonFail').style.display = 'none';
            document.getElementById('simonRestart').style.display = 'none';
            drawSimonGrid();
            showSimonSequence();
        }

        function showSimonSequence() {
            simonClickable = false;
            let i = 0;
            let clickCounts = Array(9).fill(0);
            for (let idx of simonSequence) clickCounts[idx]++;
            if (simonSequence.length > 1) {
                let totalClips = simonSequence.length;
                if (totalClips >= 9) {
                    document.getElementById('simonStatus').textContent = "Ви перемогли!";
                    document.getElementById('simonStatus').style.display = 'block';
                    simonActive = false;
                    setTimeout(() => {
                        document.getElementById('captchaSimonModal').style.display = 'none';
                        openTicTacToeAfterSimon();
                    }, 1200);
                    return;
                }
            }
            function highlight() {
                if(i < simonSequence.length) {
                    let idx = simonSequence[i];
                    simonGrid[idx].style.background = simonActiveColor;
                    setTimeout(() => {
                        simonGrid[idx].style.background = simonColors[idx];
                        i++;
                        setTimeout(highlight, 250);
                    }, 400);
                } else {
                    simonClickable = true;
                }
            }
            setTimeout(highlight, 400);
        }

        function drawSimonGrid() {
            const grid = document.getElementById('simonGrid');
            grid.innerHTML = '';
            simonGrid.length = 0;
            for(let i=0;i<9;i++) {
                const cell = document.createElement('div');
                cell.style.width = "48px";
                cell.style.height = "48px";
                cell.style.background = simonColors[i];
                cell.style.borderRadius = "8px";
                cell.style.cursor = simonClickable ? "pointer" : "default";
                cell.style.boxShadow = "0 1px 4px rgba(0,0,0,0.08)";
                cell.addEventListener('click', () => {
                    if(!simonClickable || !simonActive) return;
                    if(i === simonSequence[simonStep]) {
                        cell.style.background = simonActiveColor;
                        setTimeout(() => {
                            cell.style.background = simonColors[i];
                        }, 200);
                        simonStep++;
                        if(simonStep === simonSequence.length) {
                            let clickCounts = Array(9).fill(0);
                            for (let idx of simonSequence) clickCounts[idx]++;
                            let totalClips = simonSequence.length;
                            if (totalClips >= 9) {
                                document.getElementById('simonStatus').textContent = "Ви перемогли!";
                                document.getElementById('simonStatus').style.display = 'block';
                                simonActive = false;
                                setTimeout(() => {
                                    document.getElementById('captchaSimonModal').style.display = 'none';
                                    openTicTacToeAfterSimon();
                                }, 1200);
                            } else {
                                simonStep = 0;
                                simonSequence.push(randomSimonCell());
                                setTimeout(showSimonSequence, 700);
                            }
                        }
                    } else {
                        simonFailReload();
                    }
                });
                simonGrid.push(cell);
                grid.appendChild(cell);
            }
        }

        document.getElementById('simonRestart').onclick = startSimonGame;
        document.getElementById('closeSimon').onclick = function() {
            document.getElementById('captchaSimonModal').style.display = 'none';
            simonActive = false;
        };

        let tttBoard, tttHuman, tttAI, tttCurrent, tttAttempts, tttHumanWins, tttStarter, tttGameActive;

        function resetTicTacToe(starter = "ai") {
            tttBoard = Array(9).fill("");
            tttHuman = "X";
            tttAI = "O";
            tttCurrent = starter;
            tttStarter = starter;
            tttGameActive = true;
            document.getElementById('tttStatus').style.display = 'none';
            document.getElementById('tttFail').style.display = 'none';
            document.getElementById('tttRestart').style.display = 'none';
            updateFailCounters();
            drawTicTacToe();
            if (tttCurrent === "ai") setTimeout(aiMove, 400);
        }

        function drawTicTacToe() {
            const grid = document.getElementById('tttGrid');
            grid.innerHTML = '';
            for(let i=0;i<9;i++) {
                const cell = document.createElement('div');
                cell.style.width = "48px";
                cell.style.height = "48px";
                cell.style.background = "#e0e0e0";
                cell.style.borderRadius = "8px";
                cell.style.cursor = (tttCurrent === "human" && tttBoard[i] === "" && tttGameActive) ? "pointer" : "default";
                cell.style.boxShadow = "0 1px 4px rgba(0,0,0,0.08)";
                cell.style.display = "flex";
                cell.style.alignItems = "center";
                cell.style.justifyContent = "center";
                cell.style.fontSize = "32px";
                cell.style.fontWeight = "bold";
                if (tttBoard[i] === "X") {
                    cell.style.color = "#ea4335";
                } else if (tttBoard[i] === "O") {
                    cell.style.color = "#4285f4";
                } else {
                    cell.style.color = "#222";
                }
                cell.textContent = tttBoard[i];
                cell.addEventListener('click', () => {
                    if(tttCurrent !== "human" || tttBoard[i] !== "" || !tttGameActive) return;
                    tttBoard[i] = tttHuman;
                    tttCurrent = "ai";
                    drawTicTacToe();
                    if(checkTicTacToeWin(tttHuman)) {
                        tttHumanWins++;
                        tttGameActive = false;
                        document.getElementById('tttStatus').textContent = `Ви перемогли! (${tttHumanWins}/${tttAttempts} перемог)`;
                        document.getElementById('tttStatus').style.display = 'block';
                        document.getElementById('tttRestart').style.display = 'block';
                        checkTicTacToeEnd();
                    } else if(tttBoard.every(cell => cell !== "")) {
                        tttGameActive = false;
                        document.getElementById('tttStatus').textContent = "Нічия!";
                        document.getElementById('tttStatus').style.display = 'block';
                        document.getElementById('tttRestart').style.display = 'block';
                    } else {
                        setTimeout(aiMove, 400);
                    }
                });
                grid.appendChild(cell);
            }
        }

        function aiMove() {
            if(!tttGameActive) return;
            let move;
            if (Math.random() < 0.6) {
                move = findBestMove(tttAI) || findBestMove(tttHuman);
                if (move === null || move === undefined) {
                    let free = [];
                    for(let i=0;i<9;i++) if(tttBoard[i]==="") free.push(i);
                    move = free[Math.floor(Math.random()*free.length)];
                }
            } else {
                let free = [];
                for(let i=0;i<9;i++) if(tttBoard[i]==="") free.push(i);
                move = free[Math.floor(Math.random()*free.length)];
            }
            if(move !== undefined) tttBoard[move] = tttAI;
            tttCurrent = "human";
            drawTicTacToe();
            if(checkTicTacToeWin(tttAI)) {
                tttGameActive = false;
                document.getElementById('tttFail').textContent = `ШІ переміг! (${tttHumanWins}/${tttAttempts} перемог)`;
                document.getElementById('tttFail').style.display = 'block';
                document.getElementById('tttRestart').style.display = 'block';
                checkTicTacToeEnd();
            } else if(tttBoard.every(cell => cell !== "")) {
                tttGameActive = false;
                document.getElementById('tttStatus').textContent = "Нічия!";
                document.getElementById('tttStatus').style.display = 'block';
                document.getElementById('tttRestart').style.display = 'block';
            }
        }

        function findBestMove(player) {
            const wins = [
                [0,1,2],[3,4,5],[6,7,8],
                [0,3,6],[1,4,7],[2,5,8],
                [0,4,8],[2,4,6]
            ];
            for(const line of wins) {
                const [a,b,c] = line;
                const vals = [tttBoard[a], tttBoard[b], tttBoard[c]];
                if(vals.filter(v=>v===player).length===2 && vals.includes("")) {
                    return line[vals.indexOf("")];
                }
            }
            return null;
        }

        function checkTicTacToeWin(player) {
            const wins = [
                [0,1,2],[3,4,5],[6,7,8],
                [0,3,6],[1,4,7],[2,5,8],
                [0,4,8],[2,4,6]
            ];
            return wins.some(line => line.every(i => tttBoard[i] === player));
        }

        function checkTicTacToeEnd() {
            if(tttHumanWins >= 1) {
                document.getElementById('tttStatus').textContent = "Вітаємо! Ви перемогли ШІ!";
                document.getElementById('tttRestart').style.display = 'none';
                setTimeout(() => {
                    document.getElementById('captchaTicTacToeModal').style.display = 'none';
                    openWordSearchGame();
                }, 1500);
            } else if(tttAttempts >= 3) {
                failCount3++;
                updateFailCounters();
                document.getElementById('tttFail').textContent = "Більше немає спроб! Спробуйте пізніше.";
                document.getElementById('tttRestart').style.display = 'none';
                setTimeout(() => {
                    returnToMaze();
                }, 2000);
            }
        }

        document.getElementById('tttRestart').onclick = function() {
            tttAttempts++;
            let lastStarter = tttStarter;
            if(document.getElementById('tttStatus').textContent === "Нічия!") {
                tttStarter = (tttStarter === "human") ? "ai" : "human";
            }
            resetTicTacToe(tttStarter);
        };
        document.getElementById('closeTicTacToe').onclick = function() {
            document.getElementById('captchaTicTacToeModal').style.display = 'none';
            tttGameActive = false;
        };

        function openTicTacToeAfterSimon() {
            tttAttempts = 1;
            tttHumanWins = 0;
            tttStarter = "ai";
            resetTicTacToe(tttStarter);
            document.getElementById('captchaTicTacToeModal').style.display = 'flex';
        }

        let wordSearchGrid = [];
        let wordSearchWords = [];
        let wordSearchFoundWords = [];
        let wordSearchSelecting = false;
        let wordSearchSelection = [];
        let wordSearchCanvas, wordSearchCtx;
        let wordSearchWordColors = {};
        
        const ukrainianLetters = 'АБВГДЕЖЗИЙКЛМНОПРСТУФХЦЧШЩЮЯ';
        const brightColors = [
            '#FF9A56',
            '#FF6B9D',
            '#4ECDC4',
            '#A78BFA',
            '#FCD34D'
        ];
        
        const commonWords = [
            'ЗОРЯ', 'ВОДА', 'НЕБО', 'ПОЛЕ', 'ГОРА',
            'ДРУГ', 'УРОК', 'МЕТА', 'ВІРА', 'ДОЛЯ',
            'ДЕНЬ', 'ПТАХ', 'ЗВІР', 'РИБА', 'ЗВУК',
            'СНІГ', 'ГРАД', 'ШЛЯХ', 'ВІРШ', 'РИМА',
            'СЕЛО', 'ЛІС', 'МОРЕ', 'ОЗЕРО', 'РІЧКА',
            'ЗИМА', 'ЛІТО', 'НІЖЬ', 'ВОЛЯ', 'СИЛА',
            'МАТИ', 'ДІТИ', 'РУКА', 'НОГА', 'ТІЛО',
            'ХЛІБ', 'СІЛЬ', 'ВИНО', 'ПИВО', 'КАВА',
            'СТІЛ', 'СТУЛ', 'ДВІР', 'ПАРК', 'СКВЕР',
            'ЛЮБОВ', 'МРІЯ', 'СЛОВО', 'ЗЕМЛЯ', 'ВІТЕР',
            'КНИГА', 'ТАНЕЦЬ', 'ПІСНЯ', 'СОНЦЕ', 'МІСЯЦЬ',
            'ХМАРА', 'ВЕСНА', 'ОСІНЬ', 'КВІТКА', 'ДЕРЕВО',
            'КРИЛО', 'КОЛІР', 'БАРВА', 'ГОЛОС', 'ЗАПАХ',
            'ТЕПЛО', 'ХОЛОД', 'МОРОЗ', 'ТУМАН', 'ХВИЛЯ',
            'ПОТІК', 'КАЗКА', 'ОБРАЗ', 'ШКОЛА', 'ДУМКА',
            'ІДЕЯ', 'НАДІЯ', 'ЩАСТЯ', 'ЖИТТЯ', 'СВІТЛО',
            'ПРАВДА', 'ЧЕСТЬ', 'СЛАВА', 'НАРОД', 'МІСТО',
            'РАНОК', 'ВЕЧІР', 'ЗІРКА', 'ІСКРА', 'СКЕЛЯ',
            'ПІСОК', 'ТРАВА', 'ЛИСТЯ', 'ГІЛКА', 'КАМІНЬ',
            'ВОГОНЬ', 'ГРІМ', 'ДОРОГА', 'ВУЛИЦЯ', 'БУДИНОК',
            'ПОШУК', 'МУЗИКА', 'РАДІСТЬ', 'ДИТИНА', 'БАТЬКО',
            'РОБОТА', 'СПРАВА', 'УСПІХ', 'ЗНАННЯ', 'КРАЇНА', 'СВОБОДА',
            'КОСМОС', 'ПЛАНЕТА', 'КОРІНЬ', 'ПТАШКА', 'ТВАРИНА',
            'КОМАХА', 'БДЖОЛА', 'АРОМАТ', 'ПАХОЩІ', 'МЕЛОДІЯ',
            'СТЕЖКА', 'МАНДРИ', 'ЛЕГЕНДА', 'ІСТОРІЯ', 'ПОЕЗІЯ',
            'КАРТИНА', 'МАЛЮНОК', 'УЧЕНЬ', 'ВЧИТЕЛЬ'
        ].filter(word => word.length >= 4 && word.length <= 6);
        
        const biologicalTerms = [
            'ГЕНОМ', 'МІТОЗ',
            'БІЛОК', 'НЕЙРОН', 'ВІРУС',
            'КЛІТИНА', 'СИНАПС', 'МУТАЦІЯ'
        ].filter(word => word.length >= 4 && word.length <= 6);
        
        function getRandomLetter() {
            return ukrainianLetters[Math.floor(Math.random() * ukrainianLetters.length)];
        }
        
        function openWordSearchGame() {
            document.getElementById('captchaWordSearchModal').style.display = 'flex';
            initWordSearch();
        }
        
        function initWordSearch() {
            wordSearchGrid = Array(15).fill(null).map(() => Array(15).fill(''));
            
            const shuffledBio = [...biologicalTerms].sort(() => Math.random() - 0.5);
            const shuffledCommon = [...commonWords].sort(() => Math.random() - 0.5);
            
            const numBioWords = Math.min(2, Math.floor(Math.random() * 3));
            const numCommonWords = 5 - numBioWords;
            
            wordSearchWords = [
                ...shuffledBio.slice(0, numBioWords),
                ...shuffledCommon.slice(0, numCommonWords)
            ];
            
            wordSearchFoundWords = [];
            wordSearchSelection = [];
            wordSearchWordColors = {};
            wordSearchWords.forEach((word, index) => {
                wordSearchWordColors[word] = brightColors[index % brightColors.length];
            });
            
            for (let word of wordSearchWords) {
                placeWord(word);
            }
            
            for (let i = 0; i < 15; i++) {
                for (let j = 0; j < 15; j++) {
                    if (wordSearchGrid[i][j] === '') {
                        wordSearchGrid[i][j] = getRandomLetter();
                    }
                }
            }
            
            drawWordSearchGrid();
            drawWordList();
            setupCanvas();
        }
        
        function placeWord(word) {
            const directions = [
                {dx: 1, dy: 0},
                {dx: 0, dy: 1},
            ];
            
            let placed = false;
            let attempts = 0;
            
            while (!placed && attempts < 100) {
                const dir = directions[Math.floor(Math.random() * directions.length)];
                const startRow = Math.floor(Math.random() * 15);
                const startCol = Math.floor(Math.random() * 15);
                
                if (canPlaceWord(word, startRow, startCol, dir)) {
                    for (let i = 0; i < word.length; i++) {
                        const row = startRow + i * dir.dy;
                        const col = startCol + i * dir.dx;
                        wordSearchGrid[row][col] = word[i];
                    }
                    placed = true;
                }
                attempts++;
            }
        }
        
        function canPlaceWord(word, startRow, startCol, dir) {
            for (let i = 0; i < word.length; i++) {
                const row = startRow + i * dir.dy;
                const col = startCol + i * dir.dx;
                
                if (row < 0 || row >= 15 || col < 0 || col >= 15) {
                    return false;
                }
                
                if (wordSearchGrid[row][col] !== '' && wordSearchGrid[row][col] !== word[i]) {
                    return false;
                }
            }
            return true;
        }
        
        function drawWordSearchGrid() {
            const grid = document.getElementById('wordSearchGrid');
            grid.innerHTML = '';
            
            for (let i = 0; i < 15; i++) {
                for (let j = 0; j < 15; j++) {
                    const cell = document.createElement('div');
                    cell.className = 'word-search-cell';
                    cell.textContent = wordSearchGrid[i][j];
                    cell.dataset.row = i;
                    cell.dataset.col = j;
                    
                    cell.addEventListener('mousedown', startSelection);
                    cell.addEventListener('mouseenter', continueSelection);
                    cell.addEventListener('mouseup', endSelection);
                    
                    grid.appendChild(cell);
                }
            }
        }

        function startSelection(e) {
            wordSearchSelecting = true;
            wordSearchSelection = [];
            const row = parseInt(e.target.dataset.row);
            const col = parseInt(e.target.dataset.col);
            wordSearchSelection.push({row, col, letter: wordSearchGrid[row][col]});
            
            const tempColor = '#D1D5DB';
            highlightCells(wordSearchSelection, tempColor, true);
        }
        
        function continueSelection(e) {
            if (!wordSearchSelecting) return;
            
            const row = parseInt(e.target.dataset.row);
            const col = parseInt(e.target.dataset.col);
            
            const alreadySelected = wordSearchSelection.some(cell => cell.row === row && cell.col === col);
            if (alreadySelected) return;
            
            if (wordSearchSelection.length === 1) {
                wordSearchSelection.push({row, col, letter: wordSearchGrid[row][col]});
                const tempColor = '#D1D5DB';
                highlightCells(wordSearchSelection, tempColor, true);
            } else if (wordSearchSelection.length >= 2) {
                const start = wordSearchSelection[0];
                const newCell = {row, col, letter: wordSearchGrid[row][col]};
                
                if (isInLine(start, wordSearchSelection[wordSearchSelection.length - 1], newCell)) {
                    wordSearchSelection.push(newCell);
                    const tempColor = '#D1D5DB';
                    highlightCells(wordSearchSelection, tempColor, true);
                }
            }
        }
        
        function endSelection(e) {
            if (!wordSearchSelecting) return;
            wordSearchSelecting = false;
            
            const selectedWord = wordSearchSelection.map(cell => cell.letter).join('');
            
            if (wordSearchWords.includes(selectedWord) && !wordSearchFoundWords.includes(selectedWord)) {
                wordSearchFoundWords.push(selectedWord);
                const color = wordSearchWordColors[selectedWord];
                
                highlightCells(wordSearchSelection, color, false);
                
                drawWordList();
                
                if (wordSearchFoundWords.length === wordSearchWords.length) {
                    document.getElementById('wordSearchSuccess').style.display = 'block';
                    setTimeout(() => {
                        document.getElementById('captchaWordSearchModal').style.display = 'none';
                        openFinalModal();
                    }, 1500);
                }
            } else {
                clearTemporaryHighlight();
            }
            
            wordSearchSelection = [];
        }
        
        function isInLine(start, middle, end) {
            if (start.row === middle.row && middle.row === end.row) {
                return true;
            }
            if (start.col === middle.col && middle.col === end.col) {
                return true;
            }
            return false;
        }
        
        function highlightCells(cells, color, isTemporary) {
            cells.forEach(cell => {
                const cellElement = document.querySelector(
                    `.word-search-cell[data-row="${cell.row}"][data-col="${cell.col}"]`
                );
                if (cellElement) {
                    cellElement.style.backgroundColor = color;
                    if (!isTemporary) {
                        cellElement.classList.add('found');
                    } else {
                        cellElement.dataset.temporary = 'true';
                    }
                }
            });
        }

        function clearTemporaryHighlight() {
            document.querySelectorAll('.word-search-cell[data-temporary="true"]').forEach(cell => {
                if (!cell.classList.contains('found')) {
                    cell.style.backgroundColor = '#f5f5f5';
                }
                delete cell.dataset.temporary;
            });
        }
        
        function setupCanvas() {
            wordSearchCanvas = document.getElementById('wordSearchCanvas');
            wordSearchCtx = wordSearchCanvas.getContext('2d');
            
            const container = document.querySelector('.word-search-container');
            wordSearchCanvas.width = container.offsetWidth;
            wordSearchCanvas.height = container.offsetHeight;
        }
        
        function drawWordList() {
            const list = document.getElementById('wordList');
            list.innerHTML = '';
            
            for (let word of wordSearchWords) {
                const item = document.createElement('div');
                item.className = 'word-item';
                item.textContent = word;
                item.dataset.word = word;
                
                if (wordSearchFoundWords.includes(word)) {
                    item.classList.add('found');
                }
                
                list.appendChild(item);
            }
        }

        let evadeActive = false, evadeTimeout = null, evadeAnimFrame = null;
        let btnHuman, startLeft, startTop;
        let evadeHasBeenActivated = false;

        function openFinalModal() {
            document.getElementById('captchaFinalModal').style.display = 'flex';
            btnHuman = document.getElementById('btnHuman');
            btnHuman.style.position = "fixed";
            btnHuman.style.left = "50%";
            btnHuman.style.top = "50%";
            btnHuman.style.transform = "translate(-50%, -50%)";
            startLeft = (window.innerWidth - btnHuman.offsetWidth) / 2;
            startTop = (window.innerHeight - btnHuman.offsetHeight) / 2;
            btnHuman.style.left = startLeft + "px";
            btnHuman.style.top = startTop + "px";
            btnHuman.style.transform = "";
            evadeActive = false;
            evadeHasBeenActivated = false;
            
            btnHuman.addEventListener('mouseenter', activateEvade);
        }

        function activateEvade() {
            if (evadeActive || evadeHasBeenActivated) return;
            evadeActive = true;
            evadeHasBeenActivated = true;
            
            document.addEventListener('mousemove', trackMouseGlobal);
            if(evadeAnimFrame) cancelAnimationFrame(evadeAnimFrame);
            evadeAnimFrame = requestAnimationFrame(evadeMoveGlobal);

            if(evadeTimeout) clearTimeout(evadeTimeout);
            evadeTimeout = setTimeout(() => {
                evadeActive = false;
                document.removeEventListener('mousemove', trackMouseGlobal);
                if(evadeAnimFrame) cancelAnimationFrame(evadeAnimFrame);
                evadeAnimFrame = null;
            }, 10000);
        }

        let mousePosGlobal = {x: window.innerWidth/2, y: window.innerHeight/2};
        function trackMouseGlobal(e) {
            mousePosGlobal.x = e.clientX;
            mousePosGlobal.y = e.clientY;
        }

        function evadeMoveGlobal() {
            if (!evadeActive) {
                if(evadeAnimFrame) cancelAnimationFrame(evadeAnimFrame);
                evadeAnimFrame = null;
                return;
            }
            let curLeft = parseFloat(btnHuman.style.left);
            let curTop = parseFloat(btnHuman.style.top);

            let btnCenterX = curLeft + btnHuman.offsetWidth / 2;
            let btnCenterY = curTop + btnHuman.offsetHeight / 2;

            let dx = btnCenterX - mousePosGlobal.x;
            let dy = btnCenterY - mousePosGlobal.y;
            let dist = Math.sqrt(dx*dx + dy*dy);

            const minDist = 250;
            if (dist < minDist) {
                let angle = Math.atan2(dy, dx);
                let push = (minDist - dist) * 0.18;
                let newLeft = curLeft + Math.cos(angle) * push;
                let newTop = curTop + Math.sin(angle) * push;

                const maxLeft = window.innerWidth - btnHuman.offsetWidth - 4;
                const maxTop = window.innerHeight - btnHuman.offsetHeight - 4;
                newLeft = Math.max(2, Math.min(maxLeft, newLeft));
                newTop = Math.max(2, Math.min(maxTop, newTop));

                btnHuman.style.left = newLeft + "px";
                btnHuman.style.top = newTop + "px";
            }
            evadeAnimFrame = requestAnimationFrame(evadeMoveGlobal);
        }

        document.getElementById('btnHuman').addEventListener('click', function() {
            if(evadeActive) return;
            window.location.href = "https://www.google.com";
        });

        document.getElementById('btnRobot').addEventListener('click', function() {
            returnToMaze();
        });

        document.getElementById('closeFinal').onclick = function() {
            document.getElementById('captchaFinalModal').style.display = 'none';
            evadeActive = false;
            document.removeEventListener('mousemove', trackMouseGlobal);
            if(evadeAnimFrame) cancelAnimationFrame(evadeAnimFrame);
        };

        let hasStarted = false;
        
        document.addEventListener('click', function(e) {
            if (!hasStarted) {
                hasStarted = true;
                document.querySelector('.background-layer').classList.add('blurred');
                const googleBg = document.querySelector('.google-background');
                googleBg.classList.add('blurred');
                document.querySelector('.google-header').classList.add('blurred');
                
                document.getElementById('spinnerBox').style.display = 'flex';
                setTimeout(() => {
                    document.getElementById('spinnerBox').style.display = 'none';
                    document.getElementById('captchaFake').style.display = 'flex';
                }, 2000);
            }
        });

        document.getElementById('captchaFake').addEventListener('click', function() {
            document.getElementById('captchaModal').style.display = 'flex';
            playerPos = findStart();
            document.getElementById('captchaSuccess').style.display = 'none';
            document.getElementById('captchaFail').style.display = 'none';
            drawMaze();
            isModalActive = true;
        });

        let isModalActive = false;

        window.addEventListener('keydown', function(e) {
            if (!isModalActive || document.getElementById('captchaModal').style.display !== 'flex') return;
            let key = e.key.toLowerCase();
            let move = moveKeys[key];
            if (!move) {
                if (e.key === "ArrowUp") move = {dx:0, dy:-1};
                if (e.key === "ArrowDown") move = {dx:0, dy:1};
                if (e.key === "ArrowLeft") move = {dx:-1, dy:0};
                if (e.key === "ArrowRight") move = {dx:1, dy:0};
            }
            if (move) {
                let nx = playerPos.x + move.dx;
                let ny = playerPos.y + move.dy;
                if (nx >= 0 && ny >= 0 && ny < mazeData.length && nx < mazeData[0].length) {
                    movePlayerTo(nx, ny);
                }
                e.preventDefault();
            }
        });
        
        document.getElementById('closeWordSearch').onclick = function() {
            document.getElementById('captchaWordSearchModal').style.display = 'none';
        };
        
        document.getElementById('closeCaptcha').onclick = function() {
            document.getElementById('captchaModal').style.display = 'none';
            isModalActive = false;
        };
    </script>
</body>
</html>
